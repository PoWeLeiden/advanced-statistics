{
  "hash": "b7afe2f7ac78900f7eb7c102c4db0aa2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ncode-annotations: hover\n---\n\n\n\n# Voorspelde kansen {#sec-logit-predicted-probabilities}\n\n\n\n::: {.cell}\n\n:::\n\n\n\nIn het vorige hoofdstuk lag de focus op marginale effecten: hoeveel verandert de *probabiliteit* dat Y=1 gemiddeld genomen als X 1 eenheid stijgt. In dit hoofdstuk gebruiken we de `predictions()` functie uit het `marginaleffects` package om de onderliggende kansen te bestuderen. We gebruiken deze functie voor drie soorten voorspelde kansen:\n\n-   De voorspelde kans voor elke observatie in het model\n-   De verwachte kansen als een bepaalde predictor verschillende waarden aanneemt\n-   De verwachte kans als alle predictoren specifieke waarden aannemen\n\nZie @sec-predicted-residual-values om na te gaan hoe je deze functie gebruikt voor lineaire modellen.\n\nWe gebruiken deze packages en data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Packages\nlibrary(rio)             #laden van data\nlibrary(sjPlot)          #overzichten van data objecten\nlibrary(tidyverse)       #datamanipulatie en grafieken\nlibrary(marginaleffects) #voorspelde waarden berekenen\n\n#Data\nESS9NL <- import(\"ESS9e03, Netherlands.sav\")\n```\n:::\n\n\n\nWe maken gebruik van hetzelfde model als in het vorige hoofdstuk. We voorspelden daarin de kans dat iemand ging stemmen op basis van gender, leeftijd, vertrouwen in politici en links-rechtsideologie. We doen hier eerst de nodige data management, meer informatie over deze stappen vind je in vorige hoofdstukken:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Datamanagement\nESS9NL <- ESS9NL |>\n  #Factor maken van categorische variabelen\n  mutate(gndr_F = factorize(gndr), # <1> \n         vote_F = factorize(vote))  |> \n  #Not Eligible op missing zetten\n  mutate(vote_F = na_if(vote_F,\"Not eligible to vote\")) |> # <1> \n  #Relevel van variabelen\n  mutate(vote_F = relevel(vote_F, \"No\"), \n         gndr_F = relevel(gndr_F, \"Female\"))\n\n#Het model\nVote_model_mp <- glm(vote_F ~ gndr_F + agea + trstplt + lrscale, \n                data = ESS9NL, family = \"binomial\")\n\n#Resultaten printen\nsummary(Vote_model_mp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = vote_F ~ gndr_F + agea + trstplt + lrscale, family = \"binomial\", \n    data = ESS9NL)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.284194   0.380455  -0.747    0.455    \ngndr_FMale   0.043281   0.154201   0.281    0.779    \nagea         0.018349   0.004503   4.075 4.61e-05 ***\ntrstplt      0.195020   0.038706   5.039 4.69e-07 ***\nlrscale      0.029257   0.039306   0.744    0.457    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1173.9  on 1424  degrees of freedom\nResidual deviance: 1135.3  on 1420  degrees of freedom\n  (248 observations deleted due to missingness)\nAIC: 1145.3\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n\n## Voorspelde kans voor individuele observaties\n\nOm op basis van het logistische regressiemodel de kans dat de afhankelijke variabele Y gelijk is aan 1 (hier: dat een respondent heeft gestemd) te voorspellen voor elke observatie in het model maken we gebruik van de `predictions` functie. De resultaten worden altijd opgeslaan in een nieuwe dataset, die je een naam geeft naar keuze (hier: Vote_pred).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Resultaten opslaan in nieuw object\nVote_pred <- predictions(Vote_model_mp,\n                         conf_level = 0.95, \n                         newdata = ESS9NL)\n\n#tibble() gebruiken voor overzicht\ntibble(Vote_pred)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,673 × 580\n   rowid estimate   p.value s.value conf.low conf.high name    essround edition\n   <int>    <dbl>     <dbl>   <dbl>    <dbl>     <dbl> <chr>      <dbl> <chr>  \n 1     1    0.835  6.13e-35   114.     0.796     0.867 ESS9e03        9 3      \n 2     2    0.910  1.71e-56   185.     0.884     0.931 ESS9e03        9 3      \n 3     3    0.904  4.26e-45   147.     0.874     0.928 ESS9e03        9 3      \n 4     4   NA     NA           NA     NA        NA     ESS9e03        9 3      \n 5     5    0.864  9.71e-39   126.     0.828     0.894 ESS9e03        9 3      \n 6     6    0.912  7.81e-53   173.     0.884     0.933 ESS9e03        9 3      \n 7     7    0.800  1.32e-12    39.5    0.731     0.854 ESS9e03        9 3      \n 8     8    0.914  9.43e-31    99.7    0.877     0.941 ESS9e03        9 3      \n 9     9    0.877  1.88e-47   155.     0.845     0.903 ESS9e03        9 3      \n10    10    0.944  2.64e-39   128.     0.917     0.963 ESS9e03        9 3      \n# ℹ 1,663 more rows\n# ℹ 571 more variables: proddate <chr>, idno <dbl>, cntry <chr>, nwspol <dbl>,\n#   netusoft <dbl>, netustm <dbl>, ppltrst <dbl>, pplfair <dbl>, pplhlp <dbl>,\n#   polintr <dbl>, psppsgva <dbl>, actrolga <dbl>, psppipla <dbl>,\n#   cptppola <dbl>, trstprl <dbl>, trstlgl <dbl>, trstplc <dbl>, trstplt <dbl>,\n#   trstprt <dbl>, trstep <dbl>, trstun <dbl>, vote <dbl>, prtvtcat <dbl>,\n#   prtvtdbe <dbl>, prtvtdbg <dbl>, prtvtgch <dbl>, prtvtbcy <dbl>, …\n```\n\n\n:::\n:::\n\n\n\nDit is de syntax-uitleg:\n\n`Vote_pred <-`\n\n:   Nieuw data object met voorspelde kansen.\n\n`predictions(Vote_model_mp,`\n\n:   We voeren de predictions functie uit op het model tussen haakjes.\n\n`conf_level = 0.95,`\n\n:   Standaard betrouwbaarheidsniveau. De waarde kan veranderd worden (bv. `conf_level = 0.99`).\n\n`newdata = ESS9NL)`\n\n:   We kopiëren de variabelen uit de originele dataset. Dit gedeelte kan weggelaten worden als je dit niet nodig acht.\n\n## Gemiddelde voorspelde kansen\n\nWe kunnen de `predictions()` functie ook gebruiken om de gemiddelde voorspelde kans dat Y=1 te berekenen voor specifieke waarden van een onafhankelijke variabele. De andere onafhankelijke variabelen worden constant gehouden op hun gemiddelde (continue variabelen) of modus (factor variabelen). Deze voorspellingen kunnen we ook weergeven in een figuur zoals besproken in @sec-presentation-predicted-probability-plots .\n\n### Continue onafhankelijke variabele\n\nDe volgende code gebruiken we als de predictor die ons interesseert continu is. Hier berekenen we de gemiddelde voorspelde kans om te stemmen als vertrouwen in politici (`trstplt`) verandert.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nESS9NL |> \n  select(trstplt) |> \n  view_df()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption>Data frame: select(ESS9NL, trstplt)</caption>\n<tr>\n<th style=\"border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;\">ID</th><th style=\"border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;\">Name</th><th style=\"border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;\">Label</th><th style=\"border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;\">Values</th><th style=\"border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;\">Value Labels</th>\n</tr>\n<tr>\n<td style=\"padding:0.2cm; text-align:left; vertical-align:top;\">1</td>\n<td style=\"padding:0.2cm; text-align:left; vertical-align:top;\">trstplt</td>\n<td style=\"padding:0.2cm; text-align:left; vertical-align:top;\">Trust in politicians</td>\n<td style=\"padding:0.2cm; text-align:left; vertical-align:top;\">0<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>77<br>88<br>99</td>\n<td style=\"padding:0.2cm; text-align:left; vertical-align:top;\">No trust at all<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>Complete trust<br>Refusal<br>Don't know<br>No answer</td>\n</tr>\n\n</table>\n`````\n:::\n\n```{.r .cell-code}\ntable(ESS9NL$trstplt)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  0   1   2   3   4   5   6   7   8   9  10 \n 43  41  68  90 173 292 457 375  87  16   8 \n```\n\n\n:::\n:::\n\n\n\nDe variabele loopt van 0 tot 10 dus deze waarden gebruiken we als minimum en maximum. We berekenen verder de kans per interval van 2 eenheden (missing waarden zijn reeds op NA gezet). We zouden ook voor elke eenheid de kans kunnen berekenen maar dit geeft vrij veel output, wellicht meer dan we nodig hebben. We zouden in plaats van deze intervallen ook minimum, 1ste kwartiel, mediaan, 3rde kwartiel en maximum van de variabele kunnen gebruiken (zie @sec-predictions-for-a-continuous-predictor-variable voor het proces om deze waarden te verkrijgen).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Voorspellingen in nieuw object\nPred_conts <- predictions(Vote_model_mp,\n                          newdata = datagrid(trstplt = seq(from = 0, to = 10, by = 2))) \n```\n:::\n\n\n\n`newdata = datagrid(trstplt`\n\n:   Alle predictoren in het model worden op hun gemiddelde/modus gehouden behalve de predictor die tussen haakjes staat.\n\n`= seq(from=0,to=10,by=2)))`\n\n:   We vragen hier voorspellingen voor een sequentie (`seq`) van waarden: van (`from`) het minimum tot (`to`) het maximum met tussenstappen (`by`) van 2. We zouden als alternatief deze code kunnen gebruiken: `trstplt = c(0,2,4,6,8,10)`).\n\nLaten we de voorspellingen bekijken:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(Pred_conts) # <1>\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 11\n  rowid estimate  p.value s.value conf.low conf.high gndr_F  agea lrscale\n  <int>    <dbl>    <dbl>   <dbl>    <dbl>     <dbl> <fct>  <dbl>   <dbl>\n1     1    0.699 9.37e- 5    13.4    0.603     0.779 Male    50.7    5.15\n2     2    0.774 1.09e-15    49.7    0.717     0.822 Male    50.7    5.15\n3     3    0.835 1.61e-46   152.     0.802     0.863 Male    50.7    5.15\n4     4    0.882 1.29e-64   212.     0.856     0.904 Male    50.7    5.15\n5     5    0.917 6.30e-48   157.     0.889     0.938 Male    50.7    5.15\n6     6    0.942 3.65e-34   111.     0.912     0.962 Male    50.7    5.15\n# ℹ 2 more variables: trstplt <dbl>, vote_F <fct>\n```\n\n\n:::\n:::\n\n\n\n1.  `tibble()` wordt gebruikt om de onderliggende data beter te kunnen zien.\n\n::: callout-note\n#### Output uitleg\n\nDe output is gelijkaardig aan die voor voorspellingen voor lineaire regressiemodellen (zie @sec-predicted-residual-values):\n\n-   De `estimate` kolom bevat de voorspelde kans. We doen dit getal \\*100 om de kans in percent uit te drukken. bv. Voor iemand met een score van '0' op de schaal `trstplt` verwachten we een kans om te stemmen van 69,86%.\n-   De `p.value` t.e.m. `conf.high` kolommen geven de onzekerheid van de schatting weer.\n-   We kunnen ook de kolommen zien voor de andere onafhankelijke variabelen in het model (`gndr_F`, `agea`, `lrscale)` . Deze kolommen tonen de waarde waarop deze variabelen constant worden gehouden. De `predictions()` functie houdt continue variabelen op hun gemiddelde en factor variabelen op hun modus als je `newdata = datagrid()` gebruikt zoals we hierboven gedaan hebben.\n-   De laatste 2 kolommen tonen `trstplt`, met de waarden gebruikt om de voorspelling te berekenen en een kolom (niet zichtbaar hier) met de Y (`vote_F`) die toont welke categorie voorspeld wordt.\n:::\n\n### Factor onafhankelijke variabele\n\nDe code voor categorische variabelen is licht anders. We gebruiken hier de `by=` optie. In dit voorbeeld berekenen we de gemiddelde voorspelde kans voor mannen en vrouwen (met andere predictoren constant gehouden op hun gemiddelde).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#voorspellingen in nieuw object\nPred_cat <- predictions(Vote_model_mp,\n              by=\"gndr_F\", \n              newdata = \"mean\") \n\n#tibble voor overzicht\ntibble(Pred_cat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 13\n  rowid gndr_F estimate std.error statistic p.value s.value conf.low conf.high\n  <int> <fct>     <dbl>     <dbl>     <dbl>   <dbl>   <dbl>    <dbl>     <dbl>\n1     1 Female    0.863    0.0133      65.1       0     Inf    0.837     0.889\n2     2 Male      0.868    0.0127      68.2       0     Inf    0.843     0.893\n# ℹ 4 more variables: agea <dbl>, trstplt <dbl>, lrscale <dbl>,\n#   rowid_dedup <int>\n```\n\n\n:::\n:::\n\n\n\n`by=\"gndr_F\"`\n\n:   Met deze optie duiden we aan dat we voor elk niveau van de factor variabele een voorspelde kans willen berekenen.\n\n`newdata = \"mean\"`\n\n:   Deze optie moeten we toevoegen om duidelijk te maken dat andere predictoren op hun gemiddelde/modus gehouden moeten worden. Deze optie moet samen met `by=` gebruikt worden.\n\n## Voorspelde kansen voor specifieke waarden van predictoren\n\nTen slotte kunnen we de voorspelde kans op Y berekenen als een observatie bepaalde, hypothetische waarden zou aannemen.\n\nBijvoorbeeld, hier berekenen we de voorspelde kans om te stemmen voor een man (`gndr`), die 33 jaar oud is (`agea`), een score van 2 heeft voor vertrouwen in politici (`trstplt`) en een score van 8 heeft op de links-rechts schaal (`lrscale`). We moeten hiervoor de waarden voor alle predictoren verduidelijken tussen haakjes bij `newdata=datagrid`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Berekenen en opslaan in object\nPred_specific <- predictions(Vote_model_mp,\n                             newdata = datagrid(gndr_F=c(\"Male\"), # <1>\n                                                agea=c(33),   \n                                                trstplt=c(2), \n                                                lrscale=c(8)))\n#bekijken\nPred_specific\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n gndr_F agea trstplt lrscale Estimate Pr(>|z|)    S 2.5 % 97.5 %\n   Male   33       2       8    0.729   <0.001 20.2 0.645  0.799\n\nType:  invlink(link) \n```\n\n\n:::\n:::\n\n\n\n1.  We gebruiken haakjes omdat dit een factor variabele is met labels voor categorieën.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}