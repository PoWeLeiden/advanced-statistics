{"title":"Model Fit en Modellen Vergelijken","markdown":{"headingText":"Model Fit en Modellen Vergelijken","headingAttr":{"id":"sec-model-fit","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| echo: false\n#| message: false\n#| warning: false\n\n#Packages\nlibrary(rio)             #laden van data\nlibrary(tidyverse)       #datamanipulatie en grafieken\nlibrary(broom)           #samenvattingen regressiemodellen\nlibrary(parameters)      #berekenen gestandaardiseerde coëfficiënten\nlibrary(marginaleffects) #voorspelde waarden berekenen\n\n#Import Data\ndemdata <- import(\"data/demdata.rds\") |> \n  as_tibble()\n\n#Some data cleaning\ndemdata <- demdata |>  \n  mutate(TYPEDEMO1984_factor = factorize(TYPEDEMO1984), \n         Typeregime2006_factor = factorize(Typeregime2006))\n\n```\n\nTot nu lag de focus op individuele coëfficiënten. Nu verschuiven we de focus naar model 'fit', oftewel de mate waarin het model bij de data past. We bekijken ook hoe we de fit van meerdere modellen kunnen vergelijken.\n\n```{r}\n#| eval: false\n\n#Packages\nlibrary(rio)             #laden van data\nlibrary(tidyverse)       #datamanipulatie en grafieken\nlibrary(broom)           #samenvattingen regressiemodellen\n\n##Importeer data en data management\ndemdata <- import(\"demdata.rds\") |> \n  as_tibble()\n\ndemdata <- demdata |>  \n  mutate(TYPEDEMO1984_factor = factorize(TYPEDEMO1984), \n         Typeregime2006_factor = factorize(Typeregime2006))\n\n\n```\n\n## R^2^, Adjusted R^2^ en de F-Test\n\nOns voorbeeld hier is een regressiemodel waarin we de electorale democratiescore van een land in 2020 (`v2x_polyarchy`) voorspellen aan de hand van gepercipieerde corruptie in dat land (`cpi)`, politiek geweld (`v2caviol`), en regimestatus in 1984 (`TYPEDEMO1984_factor`).\n\n```{r}\nmodel_multiple <- lm(v2x_polyarchy ~ cpi + v2caviol + TYPEDEMO1984_factor, data=demdata)\n```\n\nDe meeste model fit statistieken verkrijgen we simpelweg via de `summary()` functie:\n\n```{r}\nsummary(model_multiple)\n```\n\n::: callout-note\n#### Output uitleg\n\nModel fit statistieken vinden we onderaan de output. \"Multiple R-Squared\" geeft de $R^2$ (R kwadraat) statistiek. \"Adjusted R-Squared\" geeft de $R^2$ gecorrigeerd voor het aantal predictoren in het model. De F-statistiek geeft informatie over de statistische significantie van het model.\n\n-   Multiple R-squared: Dit toont de $R^2$ (R kwadraat) statistiek, die meestal geïnterpreteerd wordt in termen van % van de variatie in Y verklaard door de predictoren in het model\n-   Adjusted R-squared: Dit toont de $R^2$ gecorrigeerd voor het aantal predictoren in het model.\n-   F-statistic...: De F-statistiek geeft informatie over de statistische significantie van het model. Het eerste getal is de F-statistiek zelf (`r round(glance(model_multiple)$statistic, 2)`). Het cijfer achter \"p-value:\" is de p-waarde voor de F-statistiek. De nulhypothese die hierbij getest wordt is dat geen enkele van de onafhankelijke variabelen (hier: `cpi, v2caviol, TYPEDEMO1984`) statistisch significant is. Een statistisch signifcante F-statistiek betekent dat op z'n minst 1 predictor significant is.\n:::\n\nDeze output kunnen we ook verkrijgen via de `glance()` functie uit het `broom` package:\n\n```{r}\nglance(model_multiple)\n```\n\nDe relevante statistieken vind je bij `r.squared` (R^2^), `adj.r.squared` (Adjusted R^2^), `statistic` (F-statistic), en `p.value` (p-waarde voor de F-statistiek) kolommen. `nobs` toont het aantal observaties gebruikt in het model.\n\n## Modellen vergelijken {#sec-linear-comparing-models}\n\nDe F-statistiek gaat na of het model een significant verbeterde voorspelling geeft dan een 'nul model' zonder predictoren, oftewel het gemiddelde van de afhankelijke variabele. We kunnen ook meerdere modellen vergelijken met elkaar. Hier vergelijken we een model met enkel `cpi` als onafhankelijke, dan een model met zowel `cpi` als `v2caviol`, en ten slotte een model met alle predictoren. Deze modellen zijn 'nested', dat wil zeggen dat meer uitgebreide modellen alle variabelen bevatten van de meer simpele modellen.\n\nOm deze vergelijking te maken moeten we er wel voor zorgen dat onze modellen met dezelfde observaties werken en dus dezelfde N hebben. Dit kunnen we bereiken door een nieuwe dataset aan te maken met complete waarden (non-missing) voor alle variabelen die gebruikt worden in het meest complete model.\n\n```{r}\ndemdata_complete <- demdata |> \n  filter(complete.cases(v2x_polyarchy, cpi, v2caviol, TYPEDEMO1984_factor))\n```\n\nDeze dataset gebruiken we om onze modellen te schatten. Om een volledige vergelijking mogelijk te maken, schatten we ook een nulmodel zonder onafhankelijke variabelen met enkel een intercept (~ 1). Dit intercept bevat de gemiddelde waarde voor Y in de dataset (i.e. onze beste voorspelling zonder predictoren):\n\n```{r}\n#Null model\nmodel1 <- lm(v2x_polyarchy ~ 1, data = demdata_complete)\n\n#Model with just cpi\nmodel2 <- lm(v2x_polyarchy ~ cpi, data = demdata_complete)\n\n#Model with cpi & v2caviol\nmodel3 <- lm(v2x_polyarchy ~ cpi + v2caviol, data = demdata_complete)\n\n#Model with all predictors\nmodel4 <- lm(v2x_polyarchy ~ cpi + v2caviol + TYPEDEMO1984_factor, data = demdata_complete)\n```\n\nWe kunnen de R2/Adj. R-Squared van de modellen vergelijken om te bekijken welk model het beste past. Dit geeft ons echter geen significantietoets:\n\n|  Model  |                  R2                   |                  Adj. R2                  |\n|:----------------:|:------------------------:|:---------------------------:|\n| Model 1 |     `r glance(model1)$r.squared`      |     `r glance(model1)$adj.r.squared`      |\n| Model 2 | `r round(glance(model2)$r.squared,3)` | `r round(glance(model2)$adj.r.squared,3)` |\n| Model 3 | `r round(glance(model3)$r.squared,3)` | `r round(glance(model3)$adj.r.squared,3)` |\n| Model 4 | `r round(glance(model4)$r.squared,3)` | `r round(glance(model4)$adj.r.squared,3)` |\n\nModel 4 lijkt het beste te passen, maar om de significantietoets uit te voeren moeten we de `anova()` functie gebruiken. Deze is ingebouwd in R.\n\n```{r}\nanova(model1, model2, model3, model4)\n```\n\n`anova()`\n\n:   We voeren de functie uit op de modellen tussen haakjes.\n\n::: callout-note\n#### Output uitleg\n\nHet eerste deel van de output toont welke modellen vergeleken worden met elkaar. De onderste helft bevat het volgende:\n\n-   Res.Df: De residual degrees of freedom (vrijheidsgraden) van het model\n-   RSS: Dit staat voor \"residual sum of squares\". RSS meet de variatie tussen de residuals in het model. RSS = $\\sum(y_{i} - \\hat{y}_{i})^2$, waarbij $\\sum$ staat voor \"sum up\", $y_{i}$ is de geobserveerde Y voor een observatie in het model, and $\\hat{y}_{i}$ is de voorspelde waarde voor diezelfde observatie.[^linear_06-1] RSS vertelt ons hoeveel van de variatie in Y het model *niet* kan verklaren of voorspellen. Een model met een lagere RSS voorspelt de Y beter, maar het verschil in RSS tussen modellen is niet altijd significant. We hebben dus nog een significantietoets nodig.\n-   DF: Vrijheidsgraden. In de praktijk de hoeveelheid onafhankelijke variabelen toegevoegd in vergelijking met het voorgaande model. Dit getal is 1 als er 1 predictor werd toegevoegd in vergelijking met het vorige model in bovenstaande rij.[^linear_06-2]\n-   Sum of Sq: De *model* of \"regression\" sum of squares is gebaseerd op de volgende formule: $\\sum(\\hat{y}_{i} - \\bar{y})^2$, waarbij $\\hat{y}_{i}$ de voorspelde waarde is voor een observatie in het model, en $\\bar{y}$ de gemiddelde waarde voor Y op basis van alle observaties in het model.[^linear_06-3] De model sum of squares meet de variatie in Y die verklaart wordt door de predictoren in het model. De Sum of Sq in de `anova()` output toont de verandering in Sum of Sq ten opzichte van het voorgaande model. Hoe hoger de stijging hoe beter, maar hier moet ook een signifcantietest voor gebeuren.\n-   F & Pr(\\>F): De F-statistiek en bijhorende p-waarde. De nulhypothese is dat het model in de desbetreffende rij niet beter past dan het model in de voorgaande rij. In feite test dit of tenminste 1 van de variabelen toegevoegd aan het model significant is. Indien de nulhypothese verworpen wordt, dan kunnen we zeggen dat het nieuwe model beter past.\n:::\n\n[^linear_06-1]: Deze vergelijking behoort niet tot de leerstof.\n\n[^linear_06-2]: De DF kolom geeft op zich niet weer hoeveel extra *onafhankelijke variabelen* werden toegevoegd, maar wel hoeveel nieuwe coëfficiënten (of termen) werden toegevoegd. Dit is vooral van belang bij factor variabelen (zeker als ze 3 of meer categorieën hebben). Hoewel je misschien 1 factor variabele toevoegt, kun je meer dan 1 coëfficiënt (en dus DF) krijgen als je voor meerdere categorieën dummy variabelen moet toevoegen.\n\n[^linear_06-3]: Deze vergelijking behoort niet tot de leerstof.\n\nWe kunnen de output als volgt lezen: Model 2 past hier beter dan 1 (nulmodel), Model 3 past niet beter dan 2, en Model 4 past beter dan 3. We kunnen ook Modellen 1 en 2 direct met Model 4 vergelijken:\n\n```{r}\n#Model 4 vs. Model 2\nanova(model2, model4)\n\n#Model 4 vs. Model 1\nanova(model1, model4)\n```\n\n::: callout-important\n#### Waarschuwing!\n\n`anova()` De volgorde van de modellen is van belang voor de uitkomst. Hierboven vergelijken we telkens een complexer model met een simpeler model. Indien we schrijven \"(model4, model1, model2\", \"model3\"), dan vergelijkt R model 1 tegen 4, model 2 tegen 1 enz.\n\n```{r}\nanova(model4, model1, model2, model3)\n```\n\nDe tweede rij vergelijkt nu het nulmodel (`model1`) met het meest complexe model (`model4`). We krijgen een negatieve waarde voor \"DF\" en \"Sum of Sq\" omdat Model 1 minder predictoren heeft en ook minder goed past. Het verschil is statistisch significant. Dit interpreteren we nu als: model 4 is beter dan model 1.De derde rij vergelijkt `model2` (enkel `cpi` als predictor) met `model1` (het nulmodel). De resultaten zijn dezelfde als hierboven. De resultaten voor de laatste rij zijn ook dezelfde.\n\nLet erop dat de namen die de `anova()` functie geeft aan de modellen niet noodzakelijk dezelfde zijn als de namen die je zelf geeft (model 1 voor anova is nu ons model 4).\n\nJe kunt de fit van bepaalde modellen testen tegenover elkaar om zo stapsgewijs het beste model te vinden. Meestal zullen we meer complexe modellen vergelijken met meer simpele modellen. In de syntax gaan we dan van meest simpel naar meest complex model.\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"linear_06.html"},"language":{"toc-title-document":"Inhoudsopgave","toc-title-website":"Op deze pagina","related-formats-title":"Andere formaten","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Bron","other-links-title":"Andere Links","code-links-title":"Code Links","launch-dev-container-title":"Dev Container starten","launch-binder-title":"Binder starten","article-notebook-label":"Artikel Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Broncode downloaden","notebook-preview-back":"Terug naar Artikel","manuscript-meca-bundle":"MECA Archief","section-title-abstract":"Samenvatting","section-title-appendices":"Bijlagen","section-title-footnotes":"Voetnoten","section-title-references":"Referenties","section-title-reuse":"Hergebruik","section-title-copyright":"Auteursrechten","section-title-citation":"Citaat","appendix-attribution-cite-as":"Citeer dit werk als:","appendix-attribution-bibtex":"BibTeX citaat:","title-block-author-single":"Auteur","title-block-author-plural":"Auteurs","title-block-affiliation-single":"Affiliatie","title-block-affiliation-plural":"Affiliaties","title-block-published":"Publicatiedatum","title-block-modified":"Gewijzigd","title-block-keywords":"Trefwoorden","callout-tip-title":"Tip","callout-note-title":"Opmerking","callout-warning-title":"Waarschuwing","callout-important-title":"Belangrijk","callout-caution-title":"Opgelet","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Alle code tonen","code-tools-hide-all-code":"Alle code verbergen","code-tools-view-source":"Broncode bekijken","code-tools-source-code":"Broncode","tools-share":"Share","tools-download":"Download","code-line":"Regel","code-lines":"Regels","copy-button-tooltip":"Kopieer naar klembord","copy-button-tooltip-success":"Gekopieerd!","repo-action-links-edit":"Pagina bewerken","repo-action-links-source":"Broncode bekijken","repo-action-links-issue":"Een probleem melden","back-to-top":"Terug naar boven","search-no-results-text":"Geen resultaten","search-matching-documents-text":"Gevonden documenten","search-copy-link-title":"Kopieer link om te zoeken","search-hide-matches-text":"Extra overeenkomsten verbergen","search-more-match-text":"meer overeenkomst in dit document","search-more-matches-text":"meer overeenkomsten in dit document","search-clear-button-title":"Wissen","search-text-placeholder":"","search-detached-cancel-button-title":"Annuleren","search-submit-button-title":"Verzenden","search-label":"Zoeken","toggle-section":"Schakel sectie","toggle-sidebar":"Schakel zijbalknavigatie","toggle-dark-mode":"Schakel donkere modus","toggle-reader-mode":"Schakel leesmodus","toggle-navigation":"Schakel navigatie","crossref-fig-title":"Figuur","crossref-tbl-title":"Tabel","crossref-lst-title":"Listing","crossref-thm-title":"Stelling","crossref-lem-title":"Lemma","crossref-cor-title":"Conclusie","crossref-prp-title":"Voorstel","crossref-cnj-title":"Aanname","crossref-def-title":"Definitie","crossref-exm-title":"Voorbeeld","crossref-exr-title":"Oefening","crossref-ch-prefix":"Hoofdstuk","crossref-apx-prefix":"Bijlage","crossref-sec-prefix":"Paragraaf","crossref-eq-prefix":"Vergelijking","crossref-lof-title":"Lijst van figuren","crossref-lot-title":"Lijst van tabellen","crossref-lol-title":"Lijst van listings","environment-proof-title":"Bewijs","environment-remark-title":"Opmerking","environment-solution-title":"Oplossing","listing-page-order-by":"Sorteer op","listing-page-order-by-default":"Standaard","listing-page-order-by-date-asc":"Oudste","listing-page-order-by-date-desc":"Nieuwste","listing-page-order-by-number-desc":"Aflopend","listing-page-order-by-number-asc":"Oplopend","listing-page-field-date":"Datum","listing-page-field-title":"Titel","listing-page-field-description":"Beschrijving","listing-page-field-author":"Auteur","listing-page-field-filename":"Bestandsnaam","listing-page-field-filemodified":"Gewijzigd","listing-page-field-subtitle":"Subtitel","listing-page-field-readingtime":"Leestijd","listing-page-field-wordcount":"Woordentelling","listing-page-field-categories":"Categorieën","listing-page-minutes-compact":"{0} min","listing-page-category-all":"Alle","listing-page-no-matches":"Geen overeenkomsten","listing-page-words":"{0} woorden"},"metadata":{"lang":"nl","fig-responsive":true,"quarto-version":"1.4.555","bibliography":["references.bib"],"editor":"visual","theme":{"light":"cosmo","dark":"darkly"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}